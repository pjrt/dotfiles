#!/usr/bin/env bash

set -e

cd $(git rev-parse --show-toplevel)

lang=$(git config --local project.language)

case $lang in
  "haskell")
    # Hasktags for Haskell
    CT="hasktags -c --ignore-close-implementation -o .git/tags.$$ -R ."
    ;;
  "scala")
    # stags for Scala
    CT="stags -d 2 -o .git/tags.$$ ."
    ;;
  "")
    echo "No project.language set for project. Set one with git config --local project.language <language>"
    ;;
  *)
    echo "No tags generator for $lang. Falling back to ctags."
    CT="ctags --tag-relative=always --sort=foldcase -Rf.git/tags.$$ --exclude=.git --languages=-XML,javascript,sql,html,Iniconf,CSS,JSON,SVG,C++,Make,JavaProperties,Diff,Java $(pwd)"
    ;;
esac

trap "rm -f .git/tags.$$" EXIT
eval "$CT"
mv .git/tags.$$ .git/tags
